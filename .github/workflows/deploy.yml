- name: Create deploy branch
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  run: |
    git config user.name "github-actions"
    git config user.email "github-actions@github.com"

    # save what we need first
    cp -r backend /tmp/backend
    cp -r frontend/dist /tmp/dist

    # create clean deploy branch
    git checkout --orphan deploy
    git rm -rf .

    # restore needed files
    cp -r /tmp/backend backend
    mkdir -p deploy
    cp -r /tmp/dist deploy/dist

    git add .
    git commit -m "Deploy build ${GITHUB_SHA::7}"
    git push origin deploy --force
